#!/bin/bash

# å…«å¦è¿åŠ¿å°ç¨‹åº - å®‰è£…å®‰å…¨æ£€æŸ¥é’©å­
# åˆ›å»ºæ—¥æœŸ: 2025-06-11

# é¢œè‰²å®šä¹‰
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "ðŸ”’ å…«å¦è¿åŠ¿å°ç¨‹åº - å®‰è£…å®‰å…¨æ£€æŸ¥é’©å­"
echo "======================================"

# æ£€æŸ¥æ˜¯å¦åœ¨Gitä»“åº“ä¸­
if [ ! -d ".git" ]; then
    echo -e "${RED}âŒ é”™è¯¯: å½“å‰ç›®å½•ä¸æ˜¯Gitä»“åº“${NC}"
    exit 1
fi

# æ£€æŸ¥è‡ªåŠ¨å®‰å…¨æ£€æŸ¥è„šæœ¬æ˜¯å¦å­˜åœ¨
if [ ! -f "è‡ªåŠ¨å®‰å…¨æ£€æŸ¥.sh" ]; then
    echo -e "${RED}âŒ é”™è¯¯: è‡ªåŠ¨å®‰å…¨æ£€æŸ¥è„šæœ¬ä¸å­˜åœ¨${NC}"
    exit 1
fi

# åˆ›å»ºpre-commité’©å­
PRE_COMMIT_HOOK=".git/hooks/pre-commit"

echo -e "${BLUE}ðŸ“ åˆ›å»ºpre-commité’©å­...${NC}"

cat > "$PRE_COMMIT_HOOK" << 'EOF'
#!/bin/bash

echo "ðŸ”’ æ‰§è¡Œå®‰å…¨æ£€æŸ¥..."
./è‡ªåŠ¨å®‰å…¨æ£€æŸ¥.sh

# æ£€æŸ¥å®‰å…¨æ£€æŸ¥è„šæœ¬çš„é€€å‡ºçŠ¶æ€
if [ $? -ne 0 ]; then
    echo -e "\033[0;31mâŒ å®‰å…¨æ£€æŸ¥å¤±è´¥ï¼Œæäº¤å·²è¢«é˜»æ­¢\033[0m"
    echo -e "\033[0;31m   è¯·ä¿®å¤å®‰å…¨é—®é¢˜åŽå†æäº¤\033[0m"
    exit 1
fi

echo -e "\033[0;32mâœ… å®‰å…¨æ£€æŸ¥é€šè¿‡\033[0m"
EOF

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x "$PRE_COMMIT_HOOK"

echo -e "${GREEN}âœ… pre-commité’©å­å·²å®‰è£…${NC}"
echo "çŽ°åœ¨æ¯æ¬¡æäº¤å‰éƒ½ä¼šè‡ªåŠ¨è¿è¡Œå®‰å…¨æ£€æŸ¥"

# æ·»åŠ ä½¿ç”¨è¯´æ˜Ž
echo -e "\n${YELLOW}ðŸ“‹ ä½¿ç”¨è¯´æ˜Ž${NC}"
echo "=================================="
echo "1. æ¯æ¬¡git commitå‰ä¼šè‡ªåŠ¨è¿è¡Œå®‰å…¨æ£€æŸ¥"
echo "2. å¦‚æžœæ£€æµ‹åˆ°æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œæäº¤å°†è¢«é˜»æ­¢"
echo "3. å¦‚éœ€è·³è¿‡å®‰å…¨æ£€æŸ¥ï¼Œå¯ä½¿ç”¨: git commit --no-verify"
echo "   (ä¸æŽ¨èä½¿ç”¨--no-verifyï¼Œé™¤éžä½ ç¡®å®šæ²¡æœ‰æ•æ„Ÿä¿¡æ¯)"
echo ""
echo -e "${BLUE}ðŸ’¡ æç¤º${NC}: å»ºè®®å›¢é˜Ÿæ‰€æœ‰æˆå‘˜éƒ½è¿è¡Œæ­¤å®‰è£…è„šæœ¬" 