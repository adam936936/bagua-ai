# 微信小程序调试、部署和上线完整指南

## 📋 目录
1. [准备工作](#准备工作)
2. [本地开发调试](#本地开发调试)
3. [微信开发者工具调试](#微信开发者工具调试)
4. [真机调试](#真机调试)
5. [提交审核](#提交审核)
6. [发布上线](#发布上线)
7. [常见问题解决](#常见问题解决)

## 🚀 准备工作

### 1.1 注册微信小程序账号
1. **访问微信公众平台**
   - 网址：https://mp.weixin.qq.com/
   - 点击"立即注册" → 选择"小程序"

2. **完成注册流程**
   ```
   ✅ 填写账号信息（邮箱、密码）
   ✅ 邮箱验证
   ✅ 信息登记（个人/企业）
   ✅ 微信认证（可选，企业建议认证）
   ```

3. **获取重要信息**
   - **AppID**：在"开发" → "开发管理" → "开发设置"中获取
   - **AppSecret**：同上位置，需要管理员扫码获取

### 1.2 下载开发工具
1. **微信开发者工具**
   - 下载地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 支持 Windows、macOS、Linux

2. **安装并登录**
   - 使用微信扫码登录
   - 确保登录账号有小程序开发权限

## 🛠️ 本地开发调试

### 2.1 配置开发环境

1. **安装依赖**
   ```bash
   cd frontend
   npm install
   ```

2. **配置AppID**
   ```bash
   # 编辑 frontend/src/manifest.json
   # 将 "appid": "请填入您的微信小程序AppID" 
   # 替换为您的真实AppID
   ```

3. **配置后端API地址**
   ```typescript
   // frontend/src/utils/request.ts
   const baseURL = 'https://your-domain.com/api' // 生产环境
   // const baseURL = 'http://localhost:8081/api' // 开发环境
   ```

### 2.2 启动开发服务

1. **启动后端服务**
   ```bash
   # 在项目根目录
   ./start.sh prod  # 生产环境
   # 或
   ./start.sh dev   # 开发环境
   ```

2. **构建小程序代码**
   ```bash
   cd frontend
   npm run dev:mp-weixin
   ```

3. **查看构建结果**
   ```bash
   # 构建产物在 frontend/dist/dev/mp-weixin/ 目录
   ls -la frontend/dist/dev/mp-weixin/
   ```

## 📱 微信开发者工具调试

### 3.1 导入项目

1. **打开微信开发者工具**
2. **选择"小程序"**
3. **点击"导入项目"**
4. **填写项目信息**：
   ```
   项目目录：选择 frontend/dist/dev/mp-weixin/
   AppID：填入您的小程序AppID
   项目名称：AI智慧分析小程序
   开发模式：小程序
   ```

### 3.2 开发者工具配置

1. **基础设置**
   ```
   ✅ 详情 → 本地设置 → 不校验合法域名
   ✅ 详情 → 本地设置 → 启用ES6转ES5
   ✅ 详情 → 本地设置 → 启用样式补全
   ✅ 详情 → 本地设置 → 启用代码压缩
   ```

2. **网络配置**
   ```
   ✅ 详情 → 项目配置 → 域名信息
   ✅ 添加 request 合法域名：https://your-domain.com
   ✅ 添加 socket 合法域名（如需要）
   ```

### 3.3 功能调试

1. **页面调试**
   ```
   ✅ 检查首页加载
   ✅ 检查页面跳转
   ✅ 检查组件渲染
   ✅ 检查样式显示
   ```

2. **API调试**
   ```
   ✅ 网络请求是否正常
   ✅ 数据返回是否正确
   ✅ 错误处理是否完善
   ✅ 加载状态是否正常
   ```

3. **控制台调试**
   ```javascript
   // 在控制台测试API
   wx.request({
     url: 'https://your-domain.com/api/fortune/today-fortune',
     method: 'GET',
     success: (res) => {
       console.log('API测试成功:', res.data)
     },
     fail: (err) => {
       console.error('API测试失败:', err)
     }
   })
   ```

## 📲 真机调试

### 4.1 预览调试

1. **生成预览码**
   - 在开发者工具中点击"预览"
   - 使用微信扫描二维码

2. **真机测试**
   ```
   ✅ 页面加载速度
   ✅ 交互响应性能
   ✅ 网络请求稳定性
   ✅ 不同机型兼容性
   ✅ 不同网络环境测试
   ```

### 4.2 远程调试

1. **开启远程调试**
   - 开发者工具 → 预览 → 自动预览 → 打开调试
   - 手机端打开小程序后会显示调试信息

2. **调试功能**
   ```
   ✅ Console 日志查看
   ✅ Network 网络请求监控
   ✅ Storage 本地存储查看
   ✅ Performance 性能分析
   ```

## 🔍 提交审核

### 5.1 准备审核材料

1. **完善小程序信息**
   ```
   ✅ 小程序名称
   ✅ 小程序简介
   ✅ 小程序图标（144x144px）
   ✅ 服务类目选择
   ✅ 标签设置
   ```

2. **配置服务器域名**
   ```
   登录微信公众平台 → 开发 → 开发管理 → 开发设置 → 服务器域名
   
   request合法域名：
   ✅ https://your-domain.com
   
   注意：必须是HTTPS，且需要备案
   ```

3. **隐私政策**
   ```
   ✅ 制定隐私政策
   ✅ 在小程序中添加隐私政策链接
   ✅ 说明数据收集和使用情况
   ```

### 5.2 上传代码

1. **构建生产版本**
   ```bash
   cd frontend
   npm run build:mp-weixin
   ```

2. **上传代码**
   ```
   开发者工具 → 上传 → 填写版本号和项目备注
   版本号格式：1.0.0
   项目备注：首次发布版本
   ```

3. **提交审核**
   ```
   微信公众平台 → 管理 → 版本管理 → 开发版本 → 提交审核
   
   需要填写：
   ✅ 功能页面截图
   ✅ 功能描述
   ✅ 测试账号（如需要）
   ✅ 补充说明
   ```

### 5.3 审核要点

1. **内容合规**
   ```
   ❌ 避免涉及算命、占卜等敏感内容
   ✅ 使用"个性分析"、"趋势建议"等中性词汇
   ✅ 添加"仅供娱乐参考"等免责声明
   ```

2. **功能完整**
   ```
   ✅ 所有页面都能正常访问
   ✅ 所有功能都能正常使用
   ✅ 没有空白页面或错误页面
   ✅ 网络异常时有友好提示
   ```

3. **用户体验**
   ```
   ✅ 页面加载速度合理
   ✅ 交互逻辑清晰
   ✅ 视觉设计美观
   ✅ 文字表述准确
   ```

## 🎉 发布上线

### 6.1 审核通过后

1. **发布小程序**
   ```
   微信公众平台 → 管理 → 版本管理 → 审核版本 → 发布
   ```

2. **设置体验版**
   ```
   可以设置体验版供内部测试
   体验版不需要审核，扫码即可使用
   ```

### 6.2 上线后维护

1. **数据监控**
   ```
   ✅ 微信公众平台 → 统计 → 数据分析
   ✅ 用户访问数据
   ✅ 页面访问路径
   ✅ 用户留存情况
   ```

2. **版本更新**
   ```
   ✅ 修复bug后重新上传
   ✅ 新功能开发后提交审核
   ✅ 保持版本号递增
   ```

## ❗ 常见问题解决

### 7.1 开发问题

**问题1：网络请求失败**
```javascript
// 解决方案：检查域名配置
// 1. 确保后端域名已添加到合法域名
// 2. 确保使用HTTPS协议
// 3. 检查跨域配置
```

**问题2：页面白屏**
```javascript
// 解决方案：检查路由配置
// 1. 检查 pages.json 配置
// 2. 检查页面文件路径
// 3. 查看控制台错误信息
```

**问题3：样式不生效**
```css
/* 解决方案：使用rpx单位 */
.container {
  width: 750rpx; /* 不要使用px */
  height: 100vh;
}
```

### 7.2 审核问题

**问题1：内容违规**
```
解决方案：
✅ 修改敏感词汇
✅ 添加免责声明
✅ 强调娱乐性质
```

**问题2：功能不完整**
```
解决方案：
✅ 完善所有页面
✅ 处理异常情况
✅ 添加加载状态
```

**问题3：域名未备案**
```
解决方案：
✅ 完成域名备案
✅ 配置SSL证书
✅ 确保HTTPS访问
```

### 7.3 性能优化

1. **代码优化**
   ```javascript
   // 使用分包加载
   // 图片懒加载
   // 减少请求次数
   // 缓存常用数据
   ```

2. **体验优化**
   ```javascript
   // 添加骨架屏
   // 优化加载动画
   // 减少页面跳转层级
   // 提供离线提示
   ```

## 📞 技术支持

- **微信开发者社区**：https://developers.weixin.qq.com/community/
- **官方文档**：https://developers.weixin.qq.com/miniprogram/dev/framework/
- **审核规范**：https://developers.weixin.qq.com/miniprogram/product/

---

**注意事项**：
1. 确保后端服务稳定运行
2. 定期备份小程序代码
3. 关注微信平台政策更新
4. 保持与用户的良好沟通 